<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>PyScript - Python on website</title>
        <script src="./mini-coi-fd.js"></script>
        <script type="module" src="./pyscript/core.js" offline></script>
        <link rel="stylesheet" href="./pyscript/core.css">
        <link rel="icon" type="image/png" sizes="499x499" href="python.png">
    </head>
    <body>
        <a href="/index.html"> Back to homepage </a>
        <p>==========================================</p>
        <py-config>
            packages = ["micropip"] 
            files = ["./loady.py"]
        </py-config>
        <script type="py" terminal worker>
            import time, traceback, platform, sys

            cancel = True
            try: 
                import micropip 
                print("[INFO]: Regulary imported micropip")
            except Exception as e:
                cancel = False
                print(f"[ERROR]: Can not use micropip: {e}")
                print("Canceling pip package adding ....")
            
            async def cookie_finder():
                if cancel:
                    yes = await input("Do you wanna install pip packages (Y/n)? ")
                    if yes.lower() == 'y':
                        packs = await input("Enter package name (if multiple, split by space): ")
                        packs = packs.split()
                    else: 
                        packs = []
                else:
                    packs = []
                return packs

            def clear():
                sys.stdout.write("\033c")
                sys.stdout.flush()
            
            async def terminal():
                global cancel
                global micropip
            
                cook = await cookie_finder()
                if cook and cancel: 
                    pip = ", ".join(cook) if len(cook) > 1 else cook[0]
                    print(f"Package(s) installing: {pip}")
                    for cooks in cook:
                        print(f"Installing package {cooks}", end="\r")
                        await micropip.install(cooks)
                names = {**globals(), **locals()} 
                print("Opening terminal ...", end="\r")
                time.sleep(2.825)
                print(f"Python {sys.version} \n(Erkhemee Edition)")
                print("Type %clear and clear() for clear screen, import loady for try out my project!")
                enter = ">>>"
                alls = []
                while 1:
                   try:
                      execute= await input(f"{enter} ")
                      if execute == "%clear": 
                         clear()
                      elif not ":" in execute and enter == ">>>": 
                         enter = ">>>"
                         exec(execute, names)
                      elif enter == "..." and not bool(execute):
                         exec("\n".join(alls), names)
                         alls=[]
                         enter = ">>>"
                      elif enter == "..." or execute.strip().endswith(":"):
                         enter = "..."
                         alls.append(execute)
                      else: 
                         enter = ">>>"
                   except SystemExit as code:
                        print(f"Exited terminal. {code if code else 0}")
                        break
                   except Exception as e:
                     print("".join(traceback.format_exception(e)))
                     alls=[]
                     enter = ">>>"
                
                print("Bye! ")
            
            print("Hello from Python (Pyodide)", platform.python_version(), "\nVersion of REPL (Erkhembayr edition): \nV2.1.3")
            print("Program doesn't store your data, so don't worry!")
            print("Hint: Try entering @:/\\:@ (Developer-Mode))")
            name = await input("What is your name? ")
            if name != "@:/\\:@": 
                favs = ["Minecraft movie", "Chicken", "Strawberry", "Potato", "Geometry dash and Minecraft"]
                favr = ["Movie", "Food", "Fruit", "Vegetable", "Game"]
                for fav in favr: 
                     user = await input(f"{name}'s (Your) Favourite {fav}: ")
                print("My name is Erkhembayr")
                for a in [0, 1, 2, 3, 4]: 
                    print(f"Erkhembayr's (My) Favourite {favr[a]}: {favs[a]}")
                selector = await input("Do you want to open python terminal (yes/no): ")
                selector = selector.lower()
                if selector == "yes":
                    try:
                        await terminal()
                    except Exception as e:
                        print(f"Terminal crashed:", e)
                else:
                    print("Bye! ")
                    time.sleep(5)
            else: 
                print("Secret: UNLOCKED! You entered @:/\\:@")
                try:
                    await terminal()
                except Exception as e:
                    print(f"\n\nTerminal crashed:", e)
                    print("Consider refresh webpage and run again")
        </script>
    </body>
</html>
